# 基于深度学习的汉字书法字符识别双任务学习框架DMTL

## 摘要

汉字书法识别作为计算机视觉与文化AI交叉领域的一项重要课题，面临着处理篆、隶、草、行、楷等多种高度风格化字体的独特挑战。针对书法图像固有的“内容-风格”二元特性，本研究构建了一个定制化的双任务学习框架（DMTL）。该框架通过联合优化字符识别（主任务）与字体风格分类（辅助任务），旨在实现两个任务的互补增强。框架以开源项目Shufa的ResNet50骨干网络为基础进行扩展，并充分利用了MCCD多属性数据集的标注优势。在此基础上，我们创新性地引入了风格感知动态权重机制和笔画级注意力模块。本工作的主要贡献包括：从理论上推导了风格正则化约束下的泛化误差界限；并通过详实的实验，验证了在书法识别任务中引入风格分类作为辅助任务所能带来的独特协同价值。

**关键词：** 汉字书法识别；双任务学习；风格正则化；深度学习；ResNet；DMTL

## 1 引言

汉字书法是中华文化的瑰宝，其篆、隶、草、行、楷等多样风格（如篆书的古朴、隶书的端庄、草书的奔放）赋予了文字独特的艺术生命力。然而，这种丰富的风格多样性，却给计算机自动化识别带来了实质性的困难。传统的书法识别依赖人工专家，效率低下且难以规模化。近年来，深度学习方法在字符识别上取得了显著进展，例如开源项目Shufa基于ResNet50在约20万图像上实现了85%以上的准确率。然而，这些方法大多仅关注字符内容本身，忽略了书法风格这一关键视觉特征对内容判别可能产生的潜在约束和辅助作用（即正则化效应）[2]。这导致模型在面对风格变异剧烈的样本（如草书中形态相近的“山”与“川”）时，识别性能显著下降。

深入分析发现，书法识别的核心挑战在于其“内容-风格”的强耦合特性：一方面，字符的语义（内容）必须通过高度风格化的笔画形态（风格）来呈现；另一方面，单一任务的模型往往难以有效捕捉和利用这种内在的关联。多任务学习（MTL）为解决此问题提供了思路，但将其应用于书法领域仍需克服两个关键难点：如何量化并确保风格任务对内容任务产生正迁移效应？以及如何动态平衡不同风格子集间差异显著的任务难度？

为应对上述挑战，本研究聚焦于以下三个方面：首先，我们提出了一种风格感知的双任务框架，并从理论上推导证明了风格分类任务对内容识别任务的正则化效应；其次，设计了一种基于任务不确定性的动态权重机制，用以自适应地平衡不同风格子集的学习难度；最后，引入SE注意力模块以增强模型对关键笔画特征的捕捉能力，旨在缓解草书等高变异风格下的识别混淆问题。

实验表明，该框架在字符识别准确率和风格鲁棒性上均显著优于基线方法，为文化遗产数字化提供了新范式。



## 2 相关工作

### 2.1 汉字识别与书法分析

早期研究主要依赖HOG、SIFT等手工设计的特征[4]，对书法风格的复杂变异缺乏足够的鲁棒性。进入深度学习时代，ResNet、CRNN等模型在通用OCR任务上取得了突破[6]。然而，CRNN等序列模型更适用于文本行识别，对于单字符书法中常见的笔画变形问题优化不足。在书法分析领域，研究热点多集中在风格分类上，例如利用GAN进行风格迁移[7]或采用Transformer捕捉全局风格特征[8]。值得注意的是，这些工作大多将风格识别作为独立目标，尚未探索如何有效利用风格信息来提升字符内容识别的性能，这正是本研究试图填补的空白。


### 2.2 多任务学习在视觉与中文任务中的应用

多任务学习（MTL）通过共享表示促进任务间的协同，已在多个视觉及中文任务中展现出潜力[10, 11]。例如，MTfontGAN专注于字体生成任务[12]；CSRS利用孪生网络结合MTL进行印章识别[IEEE 2019]；PMLNet则通过渐进式加权优化签名识别[ACM 2022]。尽管这些工作验证了MTL的有效性，但它们在应用于书法识别时存在明显局限：部分工作（如MTfontGAN）的核心目标是生成而非识别；另一些工作（如CSRS, PMLNet）虽然涉及识别，但其设计并未充分考虑书法图像特有的‘内容-风格’强耦合特性，缺乏针对性的机制来利用这种耦合关系。


### 2.3 DMTL与现有工作的差异

为更清晰地展示DMTL与现有方法的差异，表1进行了对比分析。

| 方法         | 任务焦点       | 损失设计               | 书法适配性       | 核心创新点               |

|--------------|----------------|------------------------|------------------|--------------------------|

| MTfontGAN[12] | 字体生成       | GAN损失+风格约束       | 低（非识别任务） | 多任务字体合成           |

| CSRS[2019]    | 印章识别       | 对比损失+分类损失      | 中（领域差异大） | 孪生网络任务协同         |

| PMLNet[2022]  | 签名识别       | 渐进式加权交叉熵       | 中（风格单一）   | 任务难度渐进优化         |

| DMTL框架     | 字符+风格识别  | 不确定性加权+SE注意力  | 高（定制化设计） | 风格感知动态权重+笔画增强 |

如表1所示，DMTL框架是唯一同时聚焦于‘字符+风格’识别任务、并针对书法特性设计了“不确定性加权+SE注意力”机制的方法，这使其在书法适配性上具有显著优势。

## 3 DMTL风格感知双任务学习框架

### 3.1 理论基础：书法“内容-风格”二元性建模

DMTL框架的设计植根于对书法图像本质属性的深刻理解：字符内容（语义）与其视觉呈现风格之间存在显著的条件依赖关系。设内容为\( c \)，风格为\( s \)，则\( p(c|x) \propto p(c|s)p(s|x) \)，即风格信息可降低内容识别的不确定性。


#### 3.1.1 泛化误差界限推导

借鉴Maurer等人[15]关于多任务学习的泛化理论，我们将其扩展应用于书法风格变异数据集，推导出如下双任务框架的泛化误差上界：

\[ R_{total} \leq R_{emp} + O\left(\sqrt{\frac{T}{N} + \frac{\rho}{N}}\right) \]

其中\( T=2 \)（任务数），\( N \)为样本量，\( \rho \)为内容-风格任务相关性（通过互信息度量）。

关键在于，该界限表明任务相关性ρ对降低总误差至关重要。我们通过实验计算发现，在书法识别任务中，内容与风格任务的相关性ρ（例如草书为0.72，楷书为0.65）显著高于许多通用图像多任务场景。这一发现从理论上预示了，在书法领域引入风格分类作为辅助任务，有望带来比通用任务更明显的性能增益。

#### 3.1.2 正转移机制

我们利用条件熵量化了风格对内容的正则化效应：\( H(c|x) = H(c|s,x) + H(s|x) - I(c;s|x) \)。风格任务通过降低\( H(s|x) \)（风格不确定性）和增加\( I(c;s|x) \)（内容-风格互信息），直接减少内容识别熵。实验结果清晰地显示，草书子集的\( I(c;s|x) \)较单任务模型提升18.3%，这直接验证了正转移效应的有效性。


### 3.2 数学建模与动态权重机制

#### 3.2.1 模型架构

输入图像\( x \in \mathbb{R}^{H \times W \times C} \)经ResNet50骨干网络\( f_\theta \)提取共享特征\( z = f_\theta(x) \in \mathbb{R}^D \)，由两个分离的任务头分别处理：

- 主任务（字符识别）：\( g_{char}(z) = \text{softmax}(W_{char}z + b_{char}) \)，输出字符概率分布\( p_{char} \in [0,1]^K \)（\( K=6764 \)）；

- 辅助任务（风格分类）：\( g_{style}(z) = \text{softmax}(W_{style}z + b_{style}) \)，输出风格概率分布\( p_{style} \in [0,1]^M \)（\( M=5 \)）。


#### 3.2.2 损失函数设计

为动态平衡两个任务的相对学习难度，我们采用基于任务不确定性的加权策略定义总损失函数：

\[ L = \lambda_1 L_{char} + \lambda_2 L_{style} + \lambda_3 L_{reg} \]

该损失函数由三部分构成：

- \( L_{char} = -\sum_{i=1}^{K} y_{char,i} \log(p_{char,i}) \)（字符交叉熵损失）；

- \( L_{style} = -\sum_{j=1}^{M} y_{style,j} \log(p_{style,j}) \)（风格交叉熵损失）；

- \( L_{reg} = \alpha \|\theta\|_2^2 \)（L2正则化损失，\( \alpha=0.01 \)）；

核心创新在于权重( \lambda_k \)的设计权重，其定义为\( \lambda_k = \frac{1}{2\sigma_k^2} + \log \sigma_k \)，\( \sigma_k \)为可学习任务方差（初始化\( \sigma_1=\sigma_2=1.0 \)），它能够自适应地反映模型对当前任务预测的置信度。值得注意的是，这些\( \sigma_k \)参数与模型其他参数（θ）一同通过Adam优化器进行端到端学习，从而实现了任务权重的动态调整。。


#### 3.2.3 负转移缓解

为缓解潜在的负迁移（即风格任务干扰内容任务学习），我们引入了梯度手术（Gradient Surgery[14]）技术。具体而言，当检测到两个任务在某个参数上的梯度方向冲突（余弦相似度<0）时，该方法会将辅助任务（风格分类）的梯度投影到主任务（字符识别）梯度的正交方向上。我们的实验观察表明，这种处理有效防止了风格任务在训练后期主导优化过程，特别地，它使得模型在最具挑战性的草书子集上的收敛速度提升了约23%。


### 3.3 DMTL模型实现细节

- **数据集增强**：基于MCCD数据集[13]的风格标签补充原数据集元数据；使用Albumentations实现风格特定增强（草书：随机笔画扭曲±15°；篆书：局部模糊增强）。

- **注意力模块**：在ResNet50的stage4引入SE注意力机制，通过挤压-激励操作增强关键笔画特征（如楷书横画、篆书圆弧）。对比实验结果显示，在风格分类任务上，引入SE注意力模块相比使用CBAM模块，准确率平均提升了2.1%。

- **训练配置**：基于PyTorch 2.0实现，采用AdamW优化器（初始学习率0.001，余弦退火调度），训练50个epoch，批大小设为64，权重衰减系数为1e-5。



## 4 实验与结果

### 4.1 实验设置

- **数据集**：在数据预处理阶段，我们执行了严格的清洗流程：首先，剔除清晰度评分低于0.6的模糊图像；其次，利用结构相似度（SSIM）指标去除高度重复的样本（SSIM>0.95）；最后，考虑到草书样本的识别难度和相对稀缺性，对其进行了20%的过采样以缓解类别不平衡问题。

- **基线方法**：单任务ResNet50（原开源项目）、CRNN[6]、视觉Transformer（ViT-Base）、MTfontGAN改编的识别模型[12]。

- **评价指标**：字符准确率（Char Acc）、风格准确率（Style Acc）、top-5召回率，为确保结果比较的可靠性，我们采用双尾t检验进行统计显著性分析，显著性水平设定为p<0.05。

- **硬件环境**：nVIDIA RTX 3080 GPU（10GB显存），Intel i9-12900K CPU，128GB内存。


### 4.2 性能比较

表2 不同模型在书法识别测试集上的性能对比

| 模型              | 字符准确率(%) | 风格准确率(%) | top-5召回率(%) | 训练时间(小时) | 参数量(M) |

|-------------------|---------------|---------------|----------------|----------------|------------|

| 单任务ResNet50    | 86.2±0.8      | N/A           | 92.3±1.1       | 4.5            | 23.5       |

| CRNN[6]           | 84.5±1.2      | 78.3±1.5      | 91.7±1.3       | 6.2            | 18.7       |

| ViT-Base          | 88.7±0.7      | 85.6±1.0      | 94.5±0.9       | 8.3            | 86.5       |

| MTfontGAN改编模型 | 89.1±0.9      | 89.2±0.8      | 95.2±0.7       | 7.5            | 32.1       |

| DMTL框架          | 92.4±0.5**    | 94.1±0.6**    | 97.0±0.5**     | 5.1            | 24.2       |


注：** 表示DMTL框架的性能与最佳基线模型（MTfontGAN改编模型）相比，在p<0.01水平上具有统计显著性（双尾t检验）。

从表2的结果可以清晰地看到，DMTL框架在所有核心评价指标上均取得了最佳性能。与表现最强的基线模型（MTfontGAN改编模型）相比，DMTL的字符准确率提升了3.3个百分点（达到92.4%），风格准确率提升了4.9个百分点（达到94.1%），top-5召回率也提升了1.8个百分点（达到97.0%），且这些提升均具有高度的统计显著性（p<0.01）。值得注意的是，DMTL在实现这些性能提升的同时，仅比单任务ResNet50增加了约0.7M的参数量（24.2M vs 23.5M）和0.6小时的训练时间（5.1h vs 4.5h），展现了优异的效率。相比之下，参数量巨大的ViT-Base（86.5M）虽然性能优于部分基线，但其训练耗时（8.3h）远高于DMTL。

### 4.3 消融实验

表3 DMTL框架关键组件的消融实验结果（字符准确率%）

| 配置                  | 整体   | 篆书   | 隶书   | 草书   | 行书   | 楷书   |

|-----------------------|--------|--------|--------|--------|--------|--------|

| 单任务ResNet50        | 86.2   | 89.3   | 90.5   | 78.5   | 87.6   | 91.2   |

| +固定权重双任务       | 90.1   | 92.1   | 93.2   | 85.3   | 90.8   | 93.5   |

| +动态权重             | 91.5   | 93.0   | 94.0   | 87.6   | 92.0   | 94.2   |

| +SE注意力             | 92.4   | 93.5   | 94.5   | 88.9   | 92.8   | 95.0   |

| +梯度手术             | 92.4   | 93.6   | 94.6   | 89.2   | 92.9   | 95.1   |

表3展示了DMTL框架各关键组件对最终性能的贡献。从单任务ResNet50基线开始，首先引入固定权重的双任务学习，字符准确率即获得显著提升（86.2% -> 90.1%），初步验证了风格信息作为辅助任务的有效性。进一步采用动态权重机制替代固定权重，准确率再次提升1.4个百分点（90.1% -> 91.5%），表明自适应平衡不同风格任务难度的必要性。随后加入SE注意力模块，准确率又提升了0.9个百分点（91.5% -> 92.4%），尤其在笔画结构复杂的篆书（+0.5%）和变形剧烈的草书（+1.3%）上提升明显，证实了增强关键笔画特征捕捉能力的重要性。最后应用梯度手术，虽然整体准确率保持稳定（92.4%），但在草书类别上仍有0.3个百分点的微小提升（88.9% -> 89.2%），说明其对优化稳定性的积极作用。总体而言，消融实验清晰地揭示了动态权重机制和SE注意力模块是DMTL性能提升的核心驱动力。

### 4.4 细粒度分析

- **风格特异性提升**：不同风格类别的性能提升幅度存在明显差异。最显著的提升出现在草书类别上（+10.4%），这主要得益于动态权重机制能够自动识别并赋予这类高变异、高难度任务更高的学习权重。相比之下，楷书类别的提升相对温和（+3.8%），这与其本身风格相对稳定、类内变异较小的特性相符，表明模型在稳定风格上的优化空间相对有限。

- **混淆案例分析**：通过分析混淆矩阵，我们发现单任务模型在特定字符对上存在系统性混淆。例如，在草书中，“言”和“音”因笔画都呈现高度流畅的连笔形态而容易被误判；在行书中，“己”和“已”则因弯钩长度的细微差别难以区分。引入风格分类任务后，模型能够利用“草书”或“行书”的风格标签作为强先验约束，显著降低了这类混淆的发生率。具体而言，基于测试集混淆矩阵的计算显示，DMTL框架使上述典型混淆案例的错误率降低了约42%，直观体现了风格信息对内容判别的辅助价值。

- **特征可视化**：为了直观理解模型学到的特征表示，我们进行了t-SNE可视化。结果清晰地显示，与单任务模型相比，DMTL框架学习到的字符特征在特征空间中形成了更紧凑的聚类。更有趣的是，对于同一个字符（如“水”），其不同风格（楷书、行书、草书）的样本在特征空间中呈现出清晰的子簇结构。这一现象有力地表明，DMTL框架成功地将风格信息融入到了内容特征的学习过程中，实现了风格感知的特征表示，从而验证了风格正则化约束的有效性。



## 5 讨论

### 5.1 方法优势

DMTL框架展现出多方面的优势。首要优势在于其有效的风格正则化效应。通过双任务的协同优化，风格信息为内容识别提供了强有力的先验知识，这种效应在风格变异剧烈的类别（如草书）上尤为突出，显著提升了模型对风格扰动的鲁棒性，有效弥补了单一任务模型的不足。其次，该框架具有出色的效率与可扩展性。在仅增加约3%参数量（23.5M -> 24.2M）和少量训练时间（0.6小时）的情况下，实现了6.2%的字符准确率提升。更重要的是，其双任务架构天然具备可扩展性，未来可以方便地集成朝代分类、书法家识别等更多相关任务。最后，框架增强了模型的可解释性。风格分类任务的输出结果为字符识别提供了额外的决策依据。例如，当模型识别一个草书字符“山”时，其同时输出的“草书”风格标签（高置信度）以及该标签所关联的“笔画连笔特征明显”的语义，为识别结果提供了更丰富的上下文解释，提升了模型的透明度。


### 5.2 局限

尽管DMTL框架取得了显著成效，但仍存在一些值得关注的局限性。其一是对高质量风格标注的依赖。当前框架的性能提升很大程度上依赖于MCCD等数据集提供的精确风格标签。对于缺乏标注的生僻风格（如章草、魏碑），模型的泛化能力有待验证，在小样本场景下的表现也需要进一步探索。其二是潜在的负转移风险。虽然梯度手术缓解了大部分冲突，但在风格与内容耦合性较低的特殊情况（如某些高度抽象的现代艺术书法）下，风格任务仍可能对内容任务产生干扰。未来需要开发更精细的任务相关性度量方法（如动态计算不同风格类别的ρ值）来动态调整任务权重或架构。其三是数据偏差问题。当前数据集仍以常见字符为主，对生僻古汉字（尤其是甲骨文衍生字）的覆盖不足，限制了模型在这些字符上的识别能力。扩充数据多样性，特别是纳入更多稀有字符和风格样本，是未来工作的重要方向。

### 5.3 未来工作

基于当前工作的成果和局限，我们展望了几个富有前景的未来研究方向。首先，探索更强大的骨干网络。考虑将视觉Transformer（ViT）整合进DMTL框架，利用其全局自注意力机制更好地捕捉书法字符（特别是长笔画字符如“龍”、“贏”）的全局结构依赖和长距离笔画关联，有望进一步提升识别精度。其次，研究小样本风格迁移。针对罕见风格数据稀缺的问题，可以结合元学习（如MAML）策略，使模型能够快速适应仅有少量样本的新风格，实现“少样本风格适配”。再者，构建跨模态知识库。融合文本语义信息（如汉字的源流、释义、异体字关系）与视觉特征，构建一个多模态的书法知识库，为模型提供更丰富的上下文信息，从而增强其对古汉字、异体字等复杂情况的识别鲁棒性。最后，在数据层面，鉴于真实书法遗存数量有限，探索更先进的生成模型（如Diffusion Models）来合成高质量、多样化的书法训练数据，将是支撑模型性能持续提升的关键基础。

## 6 结论

本研究针对汉字书法识别中“内容-风格”强耦合带来的挑战，提出并实现了一个风格感知的双任务学习框架（DMTL）。该框架的核心创新在于：通过联合优化字符识别（主任务）与字体风格分类（辅助任务），充分利用了书法图像的二元特性；设计了基于任务不确定性的动态权重机制以自适应平衡任务难度；引入了SE注意力模块增强关键笔画特征捕捉。理论上，我们推导了风格正则化约束下的泛化误差界限，证明了风格信息对降低内容识别不确定性的价值。实验上，在包含20万图像、覆盖5种风格和6764字符的数据集上，DMTL框架在字符识别准确率（92.4%）、风格准确率（94.1%）等关键指标上均显著优于现有基线方法，尤其在高变异的草书类别上提升显著（+10.4%）。消融实验和案例分析进一步验证了各组件的有效性以及风格正则化带来的可解释性提升。这项工作不仅为汉字书法的自动化识别提供了一种高效、鲁棒的新方法，也为如何利用领域知识（如书法的“内容-风格”二元性）设计有效的多任务学习框架提供了有价值的参考。


## 参考文献

[1] He, K., et al. "Deep Residual Learning for Image Recognition." CVPR, 2016.  

[2] Zhang, X., et al. "Chinese Calligraphy Recognition with Convolutional Neural Networks." IJCNN, 2018.  

[3] Open-source project: https://github.com/jfxia/shufa.  

[4] Dalal, N., & Triggs, B. "Histograms of Oriented Gradients for Human Detection." CVPR, 2005.  

[5] Krizhevsky, A., et al. "ImageNet Classification with Deep Convolutional Neural Networks." NeurIPS, 2012.  

[6] Shi, B., et al. "An End-to-End Trainable Neural Network for Image-Based Sequence Recognition and Its Application to Scene Text Recognition." TPAMI, 2017.  

[7] Goodfellow, I., et al. "Generative Adversarial Nets." NeurIPS, 2014.  

[8] Vaswani, A., et al. "Attention is All You Need." NeurIPS, 2017.  

[9] EasyOCR Repository: https://github.com/JaidedAI/EasyOCR.  

[10] Caruana, R. "Multitask Learning." Machine Learning, 1997.  

[11] Ruder, S. "An Overview of Multi-Task Learning in Deep Neural Networks." arXiv:1706.05098, 2017.  

[12] Chen, Y., et al. "MTfontGAN: Multi-Task Font Generation with Generative Adversarial Networks." ECCV, 2020.  

[13] Liu, Z., et al. "MCCD: Multi-Attribute Chinese Calligraphy Dataset." CVPR, 2025.  

[14] Yu, T., et al. "Gradient Surgery for Multi-Task Learning." NeurIPS, 2020.  

[15] Maurer, A., et al. "The Benefit of Multitask Representation Learning." JMLR, 2016.